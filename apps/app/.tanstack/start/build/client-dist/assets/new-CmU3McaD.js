import{b as A,S as le,D as G,r as P,j as F,a as re,c as ue,h as ce}from"./main-BNT9XLv-.js";import{z as Z}from"./external-BVr6PqVY.js";function N(i,a){return typeof i=="function"?i(a):i}function C(i,a){return Y(a).reduce((t,s)=>{if(t===null)return null;if(typeof t<"u")return t[s]},i)}function $(i,a,e){const t=Y(a);function s(r){if(!t.length)return N(e,r);const o=t.shift();if(typeof o=="string"||typeof o=="number"&&!Array.isArray(r))return typeof r=="object"?(r===null&&(r={}),{...r,[o]:s(r[o])}):{[o]:s()};if(Array.isArray(r)&&typeof o=="number"){const l=r.slice(0,o);return[...l.length?l:new Array(o),s(r[o]),...r.slice(o+1)]}return[...new Array(o),s()]}return s(i)}function de(i,a){const e=Y(a);function t(s){if(!s)return;if(e.length===1){const o=e[0];if(Array.isArray(s)&&typeof o=="number")return s.filter((h,f)=>f!==o);const{[o]:l,...c}=s;return c}const r=e.shift();if(typeof r=="string"&&typeof s=="object")return{...s,[r]:t(s[r])};if(typeof r=="number"&&Array.isArray(s)){if(r>=s.length)return s;const o=s.slice(0,r);return[...o.length?o:new Array(r),t(s[r]),...s.slice(r+1)]}throw new Error("It seems we have created an infinite loop in deleteBy. ")}return t(i)}const he=/^(\d+)$/gm,fe=/\.(\d+)(?=\.)/gm,me=/^(\d+)\./gm,ve=/\.(\d+$)/gm,Me=/\.{2,}/gm,q="__int__",_=`${q}$1`;function Y(i){if(Array.isArray(i))return[...i];if(typeof i!="string")throw new Error("Path must be a string.");return i.replace(/(^\[)|]/gm,"").replace(/\[/g,".").replace(he,_).replace(fe,`.${_}.`).replace(me,`${_}.`).replace(ve,`.${_}`).replace(Me,".").split(".").map(a=>{if(a.startsWith(q)){const e=a.substring(q.length),t=parseInt(e,10);return String(t)===e?t:e}return a})}function ge(i){return!(Array.isArray(i)&&i.length===0)}function J(i,a){const e=t=>t.validators.filter(Boolean).map(s=>({cause:s.cause,validate:s.fn}));return a.validationLogic({form:a.form,validators:a.validators,event:{type:i,async:!1},runValidation:e})}function Q(i,a){const{asyncDebounceMs:e}=a,{onBlurAsyncDebounceMs:t,onChangeAsyncDebounceMs:s,onDynamicAsyncDebounceMs:r}=a.validators||{},o=e??0,l=c=>c.validators.filter(Boolean).map(h=>{const f=h?.cause||i;let u=o;switch(f){case"change":u=s??o;break;case"blur":u=t??o;break;case"dynamic":u=r??o;break;case"submit":u=0;break}return i==="submit"&&(u=0),{cause:f,validate:h.fn,debounceMs:u}});return a.validationLogic({form:a.form,validators:a.validators,event:{type:i,async:!0},runValidation:l})}const X=i=>!!i&&typeof i=="object"&&"fields"in i;function D(i,a){if(Object.is(i,a))return!0;if(typeof i!="object"||i===null||typeof a!="object"||a===null)return!1;if(i instanceof Map&&a instanceof Map){if(i.size!==a.size)return!1;for(const[s,r]of i)if(!a.has(s)||!Object.is(r,a.get(s)))return!1;return!0}if(i instanceof Set&&a instanceof Set){if(i.size!==a.size)return!1;for(const s of i)if(!a.has(s))return!1;return!0}const e=Object.keys(i),t=Object.keys(a);if(e.length!==t.length)return!1;for(const s of e)if(!t.includes(s)||!D(i[s],a[s]))return!1;return!0}const ee=({newFormValidatorError:i,isPreviousErrorFromFormValidator:a,previousErrorValue:e})=>i?{newErrorValue:i,newSource:"form"}:a?{newErrorValue:void 0,newSource:void 0}:e?{newErrorValue:e,newSource:"field"}:{newErrorValue:void 0,newSource:void 0},te=({formLevelError:i,fieldLevelError:a})=>a?{newErrorValue:a,newSource:"field"}:i?{newErrorValue:i,newSource:"form"}:{newErrorValue:void 0,newSource:void 0},T=i=>{if(!i.validators)return i.runValidation({validators:[],form:i.form});const a=i.event.async,e=a?void 0:{fn:i.validators.onMount,cause:"mount"},t={fn:a?i.validators.onChangeAsync:i.validators.onChange,cause:"change"},s={fn:a?i.validators.onBlurAsync:i.validators.onBlur,cause:"blur"},r={fn:a?i.validators.onSubmitAsync:i.validators.onSubmit,cause:"submit"},o=a?void 0:{fn:()=>{},cause:"server"};switch(i.event.type){case"mount":return i.runValidation({validators:[e],form:i.form});case"submit":return i.runValidation({validators:[t,s,r,o],form:i.form});case"server":return i.runValidation({validators:[],form:i.form});case"blur":return i.runValidation({validators:[s,o],form:i.form});case"change":return i.runValidation({validators:[t,o],form:i.form});default:throw new Error(`Unknown validation event type: ${i.event.type}`)}};function pe(i){const a=new Map;for(const e of i){const t=[...e.path??[]].map(s=>{const r=typeof s=="object"?s.key:s;return typeof r=="number"?`[${r}]`:r}).join(".").replace(/\.\[/g,"[");a.set(t,(a.get(t)??[]).concat(e))}return Object.fromEntries(a)}const se=i=>{const a=pe(i);return{form:a,fields:a}},j={validate({value:i,validationSource:a},e){const t=e["~standard"].validate(i);if(t instanceof Promise)throw new Error("async function passed to sync validator");if(t.issues)return a==="field"?t.issues:se(t.issues)},async validateAsync({value:i,validationSource:a},e){const t=await e["~standard"].validate(i);if(t.issues)return a==="field"?t.issues:se(t.issues)}},ae=i=>!!i&&"~standard"in i,U={isValidating:!1,isTouched:!1,isBlurred:!1,isDirty:!1,isPristine:!0,isValid:!0,isDefaultValue:!0,errors:[],errorMap:{},errorSourceMap:{}};function K(i){function a(u,n,d,M){const m=t(u,n,d,M);({insert:()=>l(m,u,n),remove:()=>c(m),swap:()=>M!==void 0&&f(m,u,n,M),move:()=>M!==void 0&&h(m,u,n,M)})[d]()}function e(u,n){return`${u}[${n}]`}function t(u,n,d,M){const m=[e(u,n)];if(d==="swap")m.push(e(u,M));else if(d==="move"){const[v,g]=[Math.min(n,M),Math.max(n,M)];for(let p=v;p<=g;p++)m.push(e(u,p))}else{const v=i.getFieldValue(u),g=Array.isArray(v)?v.length:0;for(let p=n+1;p<g;p++)m.push(e(u,p))}return Object.keys(i.fieldInfo).filter(v=>m.some(g=>v.startsWith(g)))}function s(u,n){return u.replace(/\[(\d+)\]/,(d,M)=>{const m=parseInt(M,10);return`[${n==="up"?m+1:Math.max(0,m-1)}]`})}function r(u,n){(n==="up"?u:[...u].reverse()).forEach(M=>{const m=s(M.toString(),n),v=i.getFieldMeta(m);v?i.setFieldMeta(M,v):i.setFieldMeta(M,o())})}const o=()=>U,l=(u,n,d)=>{r(u,"down"),u.forEach(M=>{M.toString().startsWith(e(n,d))&&i.setFieldMeta(M,o())})},c=u=>{r(u,"up")},h=(u,n,d,M)=>{const m=new Map(Object.keys(i.fieldInfo).filter(v=>v.startsWith(e(n,d))).map(v=>[v,i.getFieldMeta(v)]));r(u,d<M?"up":"down"),Object.keys(i.fieldInfo).filter(v=>v.startsWith(e(n,M))).forEach(v=>{const g=v.replace(e(n,M),e(n,d)),p=m.get(g);p&&i.setFieldMeta(v,p)})},f=(u,n,d,M)=>{u.forEach(m=>{if(!m.toString().startsWith(e(n,d)))return;const v=m.toString().replace(e(n,d),e(n,M)),[g,p]=[i.getFieldMeta(m),i.getFieldMeta(v)];g&&i.setFieldMeta(v,g),p&&i.setFieldMeta(m,p)})};return{handleArrayFieldMetaShift:a}}function H(i){return{values:i.values??{},errorMap:i.errorMap??{},fieldMetaBase:i.fieldMetaBase??{},isSubmitted:i.isSubmitted??!1,isSubmitting:i.isSubmitting??!1,isValidating:i.isValidating??!1,submissionAttempts:i.submissionAttempts??0,isSubmitSuccessful:i.isSubmitSuccessful??!1,validationMetaMap:i.validationMetaMap??{onChange:void 0,onBlur:void 0,onSubmit:void 0,onMount:void 0,onServer:void 0,onDynamic:void 0}}}class ye{constructor(a){this.options={},this.fieldInfo={},this.prevTransformArray=[],this.mount=()=>{const e=this.fieldMetaDerived.mount(),t=this.store.mount(),s=()=>{e(),t()};this.options.listeners?.onMount?.({formApi:this});const{onMount:r}=this.options.validators||{};return r&&this.validateSync("mount"),s},this.update=e=>{if(!e)return;const t=this.options;this.options=e;const s=!!e.transform?.deps?.some((l,c)=>l!==this.prevTransformArray[c]),r=e.defaultValues&&!D(e.defaultValues,t.defaultValues)&&!this.state.isTouched,o=!D(e.defaultState,t.defaultState)&&!this.state.isTouched;!r&&!o&&!s||A(()=>{this.baseStore.setState(()=>H(Object.assign({},this.state,o?e.defaultState:{},r?{values:e.defaultValues}:{},s?{_force_re_eval:!this.state._force_re_eval}:{})))})},this.reset=(e,t)=>{const{fieldMeta:s}=this.state,r=this.resetFieldMeta(s);e&&!t?.keepDefaultValues&&(this.options={...this.options,defaultValues:e}),this.baseStore.setState(()=>H({...this.options.defaultState,values:e??this.options.defaultValues??this.options.defaultState?.values,fieldMetaBase:r}))},this.validateAllFields=async e=>{const t=[];return A(()=>{Object.values(this.fieldInfo).forEach(r=>{if(!r.instance)return;const o=r.instance;t.push(Promise.resolve().then(()=>o.validate(e,{skipFormValidation:!0}))),r.instance.state.meta.isTouched||r.instance.setMeta(l=>({...l,isTouched:!0}))})}),(await Promise.all(t)).flat()},this.validateArrayFieldsStartingFrom=async(e,t,s)=>{const r=this.getFieldValue(e),o=Array.isArray(r)?Math.max(r.length-1,0):null,l=[`${e}[${t}]`];for(let u=t+1;u<=(o??0);u++)l.push(`${e}[${u}]`);const c=Object.keys(this.fieldInfo).filter(u=>l.some(n=>u.startsWith(n))),h=[];return A(()=>{c.forEach(u=>{h.push(Promise.resolve().then(()=>this.validateField(u,s)))})}),(await Promise.all(h)).flat()},this.validateField=(e,t)=>{const s=this.fieldInfo[e]?.instance;return s?(s.state.meta.isTouched||s.setMeta(r=>({...r,isTouched:!0})),s.validate(t)):[]},this.validateSync=e=>{const t=J(e,{...this.options,form:this,validationLogic:this.options.validationLogic||T});let s=!1;const r={};return A(()=>{for(const c of t){if(!c.validate)continue;const h=this.runValidator({validate:c.validate,value:{value:this.state.values,formApi:this,validationSource:"form"},type:"validate"}),{formError:f,fieldErrors:u}=x(h),n=B(c.cause);for(const d of Object.keys(this.state.fieldMeta)){const M=this.getFieldMeta(d);if(!M)continue;const{errorMap:m,errorSourceMap:v}=M,g=u?.[d],{newErrorValue:p,newSource:b}=ee({newFormValidatorError:g,isPreviousErrorFromFormValidator:v?.[n]==="form",previousErrorValue:m?.[n]});b==="form"&&(r[d]={...r[d],[n]:g}),m?.[n]!==p&&this.setFieldMeta(d,S=>({...S,errorMap:{...S.errorMap,[n]:p},errorSourceMap:{...S.errorSourceMap,[n]:b}}))}this.state.errorMap?.[n]!==f&&this.baseStore.setState(d=>({...d,errorMap:{...d.errorMap,[n]:f}})),(f||u)&&(s=!0)}const o=B("submit");this.state.errorMap?.[o]&&e!=="submit"&&!s&&this.baseStore.setState(c=>({...c,errorMap:{...c.errorMap,[o]:void 0}}));const l=B("server");this.state.errorMap?.[l]&&e!=="server"&&!s&&this.baseStore.setState(c=>({...c,errorMap:{...c.errorMap,[l]:void 0}}))}),{hasErrored:s,fieldsErrorMap:r}},this.validateAsync=async e=>{const t=Q(e,{...this.options,form:this,validationLogic:this.options.validationLogic||T});this.state.isFormValidating||this.baseStore.setState(c=>({...c,isFormValidating:!0}));const s=[];let r;for(const c of t){if(!c.validate)continue;const h=B(c.cause);this.state.validationMetaMap[h]?.lastAbortController.abort();const u=new AbortController;this.state.validationMetaMap[h]={lastAbortController:u},s.push(new Promise(async n=>{let d;try{d=await new Promise((g,p)=>{setTimeout(async()=>{if(u.signal.aborted)return g(void 0);try{g(await this.runValidator({validate:c.validate,value:{value:this.state.values,formApi:this,validationSource:"form",signal:u.signal},type:"validateAsync"}))}catch(b){p(b)}},c.debounceMs)})}catch(g){d=g}const{formError:M,fieldErrors:m}=x(d);m&&(r=r?{...r,...m}:m);const v=B(c.cause);for(const g of Object.keys(this.state.fieldMeta)){const p=this.getFieldMeta(g);if(!p)continue;const{errorMap:b,errorSourceMap:S}=p,E=r?.[g],{newErrorValue:w,newSource:k}=ee({newFormValidatorError:E,isPreviousErrorFromFormValidator:S?.[v]==="form",previousErrorValue:b?.[v]});b?.[v]!==w&&this.setFieldMeta(g,V=>({...V,errorMap:{...V.errorMap,[v]:w},errorSourceMap:{...V.errorSourceMap,[v]:k}}))}this.baseStore.setState(g=>({...g,errorMap:{...g.errorMap,[v]:M}})),n(r?{fieldErrors:r,errorMapKey:v}:void 0)}))}let o=[];const l={};if(s.length){o=await Promise.all(s);for(const c of o)if(c?.fieldErrors){const{errorMapKey:h}=c;for(const[f,u]of Object.entries(c.fieldErrors)){const d={...l[f]||{},[h]:u};l[f]=d}}}return this.baseStore.setState(c=>({...c,isFormValidating:!1})),l},this.validate=e=>{const{hasErrored:t,fieldsErrorMap:s}=this.validateSync(e);return t&&!this.options.asyncAlways?s:this.validateAsync(e)},this.getFieldValue=e=>C(this.state.values,e),this.getFieldMeta=e=>this.state.fieldMeta[e],this.getFieldInfo=e=>this.fieldInfo[e]||={instance:null,validationMetaMap:{onChange:void 0,onBlur:void 0,onSubmit:void 0,onMount:void 0,onServer:void 0,onDynamic:void 0}},this.setFieldMeta=(e,t)=>{this.baseStore.setState(s=>({...s,fieldMetaBase:{...s.fieldMetaBase,[e]:N(t,s.fieldMetaBase[e])}}))},this.resetFieldMeta=e=>Object.keys(e).reduce((t,s)=>{const r=s;return t[r]=U,t},{}),this.setFieldValue=(e,t,s)=>{const r=s?.dontUpdateMeta??!1;A(()=>{r||this.setFieldMeta(e,o=>({...o,isTouched:!0,isDirty:!0,errorMap:{...o?.errorMap,onMount:void 0}})),this.baseStore.setState(o=>({...o,values:$(o.values,e,t)}))})},this.deleteField=e=>{const s=[...Object.keys(this.fieldInfo).filter(r=>{const o=e.toString();return r!==o&&r.startsWith(o)}),e];this.baseStore.setState(r=>{const o={...r};return s.forEach(l=>{o.values=de(o.values,l),delete this.fieldInfo[l],delete o.fieldMetaBase[l]}),o})},this.pushFieldValue=(e,t,s)=>{this.setFieldValue(e,r=>[...Array.isArray(r)?r:[],t],s),this.validateField(e,"change")},this.insertFieldValue=async(e,t,s,r)=>{this.setFieldValue(e,o=>[...o.slice(0,t),s,...o.slice(t)],r),await this.validateField(e,"change"),K(this).handleArrayFieldMetaShift(e,t,"insert"),await this.validateArrayFieldsStartingFrom(e,t,"change")},this.replaceFieldValue=async(e,t,s,r)=>{this.setFieldValue(e,o=>o.map((l,c)=>c===t?s:l),r),await this.validateField(e,"change"),await this.validateArrayFieldsStartingFrom(e,t,"change")},this.removeFieldValue=async(e,t,s)=>{const r=this.getFieldValue(e),o=Array.isArray(r)?Math.max(r.length-1,0):null;if(this.setFieldValue(e,l=>l.filter((c,h)=>h!==t),s),K(this).handleArrayFieldMetaShift(e,t,"remove"),o!==null){const l=`${e}[${o}]`;this.deleteField(l)}await this.validateField(e,"change"),await this.validateArrayFieldsStartingFrom(e,t,"change")},this.swapFieldValues=(e,t,s,r)=>{this.setFieldValue(e,o=>{const l=o[t],c=o[s];return $($(o,`${t}`,c),`${s}`,l)},r),K(this).handleArrayFieldMetaShift(e,t,"swap",s),this.validateField(e,"change"),this.validateField(`${e}[${t}]`,"change"),this.validateField(`${e}[${s}]`,"change")},this.moveFieldValues=(e,t,s,r)=>{this.setFieldValue(e,o=>{const l=[...o];return l.splice(s,0,l.splice(t,1)[0]),l},r),K(this).handleArrayFieldMetaShift(e,t,"move",s),this.validateField(e,"change"),this.validateField(`${e}[${t}]`,"change"),this.validateField(`${e}[${s}]`,"change")},this.clearFieldValues=(e,t)=>{const s=this.getFieldValue(e),r=Array.isArray(s)?Math.max(s.length-1,0):null;if(this.setFieldValue(e,[],t),r!==null)for(let o=0;o<=r;o++){const l=`${e}[${o}]`;this.deleteField(l)}this.validateField(e,"change")},this.resetField=e=>{this.baseStore.setState(t=>({...t,fieldMetaBase:{...t.fieldMetaBase,[e]:U},values:this.options.defaultValues?$(t.values,e,C(this.options.defaultValues,e)):t.values}))},this.getAllErrors=()=>({form:{errors:this.state.errors,errorMap:this.state.errorMap},fields:Object.entries(this.state.fieldMeta).reduce((e,[t,s])=>(Object.keys(s).length&&s.errors.length&&(e[t]={errors:s.errors,errorMap:s.errorMap}),e),{})}),this.parseValuesWithSchema=e=>j.validate({value:this.state.values,validationSource:"form"},e),this.parseValuesWithSchemaAsync=e=>j.validateAsync({value:this.state.values,validationSource:"form"},e),this.baseStore=new le(H({...a?.defaultState,values:a?.defaultValues??a?.defaultState?.values})),this.fieldMetaDerived=new G({deps:[this.baseStore],fn:({prevDepVals:e,currDepVals:t,prevVal:s})=>{const r=s,o=e?.[0],l=t[0];let c=0;const h={};for(const f of Object.keys(l.fieldMetaBase)){const u=l.fieldMetaBase[f],n=o?.fieldMetaBase[f],d=r?.[f],M=C(l.values,f);let m=d?.errors;if(!n||u.errorMap!==n.errorMap){m=Object.values(u.errorMap??{}).filter(S=>S!==void 0);const b=this.getFieldInfo(f)?.instance;b&&!b.options.disableErrorFlat&&(m=m?.flat(1))}const v=!ge(m??[]),g=!u.isDirty,p=D(M,C(this.options.defaultValues,f))||D(M,this.getFieldInfo(f)?.instance?.options.defaultValue);if(d&&d.isPristine===g&&d.isValid===v&&d.isDefaultValue===p&&d.errors===m&&u===n){h[f]=d,c++;continue}h[f]={...u,errors:m,isPristine:g,isValid:v,isDefaultValue:p}}return Object.keys(l.fieldMetaBase).length&&r&&c===Object.keys(l.fieldMetaBase).length?r:h}}),this.store=new G({deps:[this.baseStore,this.fieldMetaDerived],fn:({prevDepVals:e,currDepVals:t,prevVal:s})=>{const r=s,o=e?.[0],l=t[0],c=t[1],h=Object.values(c).filter(Boolean),f=h.some(y=>y.isValidating),u=h.every(y=>y.isValid),n=h.some(y=>y.isTouched),d=h.some(y=>y.isBlurred),M=h.every(y=>y.isDefaultValue),m=n&&l.errorMap?.onMount,v=h.some(y=>y.isDirty),g=!v,p=!!(l.errorMap?.onMount||h.some(y=>y?.errorMap?.onMount)),b=!!f;let S=r?.errors??[];(!o||l.errorMap!==o.errorMap)&&(S=Object.values(l.errorMap).reduce((y,O)=>O===void 0?y:O&&X(O)?(y.push(O.form),y):(y.push(O),y),[]));const E=S.length===0,w=u&&E,k=this.options.canSubmitWhenInvalid??!1,V=l.submissionAttempts===0&&!n&&!p||!b&&!l.isSubmitting&&w||k;let I=l.errorMap;if(m&&(S=S.filter(y=>y!==l.errorMap.onMount),I=Object.assign(I,{onMount:void 0})),r&&o&&r.errorMap===I&&r.fieldMeta===this.fieldMetaDerived.state&&r.errors===S&&r.isFieldsValidating===f&&r.isFieldsValid===u&&r.isFormValid===E&&r.isValid===w&&r.canSubmit===V&&r.isTouched===n&&r.isBlurred===d&&r.isPristine===g&&r.isDefaultValue===M&&r.isDirty===v&&D(o,l))return r;let L={...l,errorMap:I,fieldMeta:this.fieldMetaDerived.state,errors:S,isFieldsValidating:f,isFieldsValid:u,isFormValid:E,isValid:w,canSubmit:V,isTouched:n,isBlurred:d,isPristine:g,isDefaultValue:M,isDirty:v};const R=this.options.transform?.deps??[];if(R.length!==this.prevTransformArray.length||R.some((y,O)=>y!==this.prevTransformArray[O])){const y=Object.assign({},this,{state:L});this.options.transform?.fn(y),L=y.state,this.prevTransformArray=R}return L}}),this.handleSubmit=this.handleSubmit.bind(this),this.update(a||{})}get state(){return this.store.state}get formId(){return this.options.formId}runValidator(a){return ae(a.validate)?j[a.type](a.value,a.validate):a.validate(a.value)}async handleSubmit(a){if(this.baseStore.setState(s=>({...s,isSubmitted:!1,submissionAttempts:s.submissionAttempts+1,isSubmitSuccessful:!1})),A(()=>{Object.values(this.fieldInfo).forEach(s=>{s.instance&&(s.instance.state.meta.isTouched||s.instance.setMeta(r=>({...r,isTouched:!0})))})}),!this.state.canSubmit)return;const e=a??this.options.onSubmitMeta;this.baseStore.setState(s=>({...s,isSubmitting:!0}));const t=()=>{this.baseStore.setState(s=>({...s,isSubmitting:!1}))};if(await this.validateAllFields("submit"),!this.state.isFieldsValid){t(),this.options.onSubmitInvalid?.({value:this.state.values,formApi:this,meta:e});return}if(await this.validate("submit"),!this.state.isValid){t(),this.options.onSubmitInvalid?.({value:this.state.values,formApi:this,meta:e});return}A(()=>{Object.values(this.fieldInfo).forEach(s=>{s.instance?.options.listeners?.onSubmit?.({value:s.instance.state.value,fieldApi:s.instance})})}),this.options.listeners?.onSubmit?.({formApi:this,meta:e});try{await this.options.onSubmit?.({value:this.state.values,formApi:this,meta:e}),A(()=>{this.baseStore.setState(s=>({...s,isSubmitted:!0,isSubmitSuccessful:!0})),t()})}catch(s){throw this.baseStore.setState(r=>({...r,isSubmitSuccessful:!1})),t(),s}}setErrorMap(a){A(()=>{Object.entries(a).forEach(([e,t])=>{const s=e;if(X(t)){const{formError:r,fieldErrors:o}=x(t);for(const l of Object.keys(this.fieldInfo))this.getFieldMeta(l)&&this.setFieldMeta(l,h=>({...h,errorMap:{...h.errorMap,[s]:o?.[l]},errorSourceMap:{...h.errorSourceMap,[s]:"form"}}));this.baseStore.setState(l=>({...l,errorMap:{...l.errorMap,[s]:r}}))}else this.baseStore.setState(r=>({...r,errorMap:{...r.errorMap,[s]:t}}))})})}}function x(i){if(i){if(X(i)){const a=x(i.form).formError,e=i.fields;return{formError:a,fieldErrors:e}}return{formError:i}}return{formError:void 0}}function B(i){switch(i){case"submit":return"onSubmit";case"blur":return"onBlur";case"mount":return"onMount";case"server":return"onServer";case"dynamic":return"onDynamic";case"change":default:return"onChange"}}class be{constructor(a){this.options={},this.mount=()=>{const e=this.store.mount();this.options.defaultValue!==void 0&&this.form.setFieldValue(this.name,this.options.defaultValue,{dontUpdateMeta:!0});const t=this.getInfo();t.instance=this,this.update(this.options);const{onMount:s}=this.options.validators||{};if(s){const r=this.runValidator({validate:s,value:{value:this.state.value,fieldApi:this,validationSource:"field"},type:"validate"});r&&this.setMeta(o=>({...o,errorMap:{...o?.errorMap,onMount:r},errorSourceMap:{...o?.errorSourceMap,onMount:"field"}}))}return this.options.listeners?.onMount?.({value:this.state.value,fieldApi:this}),e},this.update=e=>{this.options=e;const t=this.name!==e.name;if(this.name=e.name,this.state.value===void 0){const s=C(e.form.options.defaultValues,e.name),r=e.defaultValue??s;t?this.setValue(o=>o||r,{dontUpdateMeta:!0}):r!==void 0&&this.setValue(r,{dontUpdateMeta:!0})}this.form.getFieldMeta(this.name)===void 0&&this.setMeta(this.state.meta)},this.getValue=()=>this.form.getFieldValue(this.name),this.setValue=(e,t)=>{this.form.setFieldValue(this.name,e,t),this.triggerOnChangeListener(),this.validate("change")},this.getMeta=()=>this.store.state.meta,this.setMeta=e=>this.form.setFieldMeta(this.name,e),this.getInfo=()=>this.form.getFieldInfo(this.name),this.pushValue=(e,t)=>{this.form.pushFieldValue(this.name,e,t),this.triggerOnChangeListener()},this.insertValue=(e,t,s)=>{this.form.insertFieldValue(this.name,e,t,s),this.triggerOnChangeListener()},this.replaceValue=(e,t,s)=>{this.form.replaceFieldValue(this.name,e,t,s),this.triggerOnChangeListener()},this.removeValue=(e,t)=>{this.form.removeFieldValue(this.name,e,t),this.triggerOnChangeListener()},this.swapValues=(e,t,s)=>{this.form.swapFieldValues(this.name,e,t,s),this.triggerOnChangeListener()},this.moveValue=(e,t,s)=>{this.form.moveFieldValues(this.name,e,t,s),this.triggerOnChangeListener()},this.clearValues=e=>{this.form.clearFieldValues(this.name,e),this.triggerOnChangeListener()},this.getLinkedFields=e=>{const t=Object.values(this.form.fieldInfo),s=[];for(const r of t){if(!r.instance)continue;const{onChangeListenTo:o,onBlurListenTo:l}=r.instance.options.validators||{};e==="change"&&o?.includes(this.name)&&s.push(r.instance),e==="blur"&&l?.includes(this.name)&&s.push(r.instance)}return s},this.validateSync=(e,t)=>{const s=J(e,{...this.options,form:this.form,validationLogic:this.form.options.validationLogic||T}),o=this.getLinkedFields(e).reduce((h,f)=>{const u=J(e,{...f.options,form:f.form,validationLogic:f.form.options.validationLogic||T});return u.forEach(n=>{n.field=f}),h.concat(u)},[]);let l=!1;A(()=>{const h=(f,u)=>{const n=W(u.cause),d=u.validate?ie(f.runValidator({validate:u.validate,value:{value:f.store.state.value,validationSource:"field",fieldApi:f},type:"validate"})):void 0,M=t[n],{newErrorValue:m,newSource:v}=te({formLevelError:M,fieldLevelError:d});f.state.meta.errorMap?.[n]!==m&&f.setMeta(g=>({...g,errorMap:{...g.errorMap,[n]:m},errorSourceMap:{...g.errorSourceMap,[n]:v}})),m&&(l=!0)};for(const f of s)h(this,f);for(const f of o)f.validate&&h(f.field,f)});const c=W("submit");return this.state.meta.errorMap?.[c]&&e!=="submit"&&!l&&this.setMeta(h=>({...h,errorMap:{...h.errorMap,[c]:void 0},errorSourceMap:{...h.errorSourceMap,[c]:void 0}})),{hasErrored:l}},this.validateAsync=async(e,t)=>{const s=Q(e,{...this.options,form:this.form,validationLogic:this.form.options.validationLogic||T}),r=await t,o=this.getLinkedFields(e),l=o.reduce((n,d)=>{const M=Q(e,{...d.options,form:d.form,validationLogic:d.form.options.validationLogic||T});return M.forEach(m=>{m.field=d}),n.concat(M)},[]);this.state.meta.isValidating||this.setMeta(n=>({...n,isValidating:!0}));for(const n of o)n.setMeta(d=>({...d,isValidating:!0}));const c=[],h=[],f=(n,d,M)=>{const m=W(d.cause);n.getInfo().validationMetaMap[m]?.lastAbortController.abort();const g=new AbortController;this.getInfo().validationMetaMap[m]={lastAbortController:g},M.push(new Promise(async p=>{let b;try{b=await new Promise((V,I)=>{this.timeoutIds.validations[d.cause]&&clearTimeout(this.timeoutIds.validations[d.cause]),this.timeoutIds.validations[d.cause]=setTimeout(async()=>{if(g.signal.aborted)return V(void 0);try{V(await this.runValidator({validate:d.validate,value:{value:n.store.state.value,fieldApi:n,signal:g.signal,validationSource:"field"},type:"validateAsync"}))}catch(L){I(L)}},d.debounceMs)})}catch(V){b=V}if(g.signal.aborted)return p(void 0);const S=ie(b),E=r[this.name]?.[m],{newErrorValue:w,newSource:k}=te({formLevelError:E,fieldLevelError:S});n.setMeta(V=>({...V,errorMap:{...V?.errorMap,[m]:w},errorSourceMap:{...V.errorSourceMap,[m]:k}})),p(w)}))};for(const n of s)n.validate&&f(this,n,c);for(const n of l)n.validate&&f(n.field,n,h);let u=[];(c.length||h.length)&&(u=await Promise.all(c),await Promise.all(h)),this.setMeta(n=>({...n,isValidating:!1}));for(const n of o)n.setMeta(d=>({...d,isValidating:!1}));return u.filter(Boolean)},this.validate=(e,t)=>{if(!this.state.meta.isTouched)return[];const{fieldsErrorMap:s}=t?.skipFormValidation?{fieldsErrorMap:{}}:this.form.validateSync(e),{hasErrored:r}=this.validateSync(e,s[this.name]??{});if(r&&!this.options.asyncAlways)return this.getInfo().validationMetaMap[W(e)]?.lastAbortController.abort(),this.state.meta.errors;const o=t?.skipFormValidation?Promise.resolve({}):this.form.validateAsync(e);return this.validateAsync(e,o)},this.handleChange=e=>{this.setValue(e)},this.handleBlur=()=>{this.state.meta.isTouched||this.setMeta(t=>({...t,isTouched:!0})),this.state.meta.isBlurred||this.setMeta(t=>({...t,isBlurred:!0})),this.validate("blur"),this.triggerOnBlurListener()},this.parseValueWithSchema=e=>j.validate({value:this.state.value,validationSource:"field"},e),this.parseValueWithSchemaAsync=e=>j.validateAsync({value:this.state.value,validationSource:"field"},e),this.form=a.form,this.name=a.name,this.timeoutIds={validations:{},listeners:{},formListeners:{}},this.store=new G({deps:[this.form.store],fn:()=>{const e=this.form.getFieldValue(this.name),t=this.form.getFieldMeta(this.name)??{...U,...a.defaultMeta};return{value:e,meta:t}}}),this.options=a}get state(){return this.store.state}runValidator(a){return ae(a.validate)?j[a.type](a.value,a.validate):a.validate(a.value)}setErrorMap(a){this.setMeta(e=>({...e,errorMap:{...e.errorMap,...a}}))}triggerOnBlurListener(){const a=this.form.options.listeners?.onBlurDebounceMs;a&&a>0?(this.timeoutIds.formListeners.blur&&clearTimeout(this.timeoutIds.formListeners.blur),this.timeoutIds.formListeners.blur=setTimeout(()=>{this.form.options.listeners?.onBlur?.({formApi:this.form,fieldApi:this})},a)):this.form.options.listeners?.onBlur?.({formApi:this.form,fieldApi:this});const e=this.options.listeners?.onBlurDebounceMs;e&&e>0?(this.timeoutIds.listeners.blur&&clearTimeout(this.timeoutIds.listeners.blur),this.timeoutIds.listeners.blur=setTimeout(()=>{this.options.listeners?.onBlur?.({value:this.state.value,fieldApi:this})},e)):this.options.listeners?.onBlur?.({value:this.state.value,fieldApi:this})}triggerOnChangeListener(){const a=this.form.options.listeners?.onChangeDebounceMs;a&&a>0?(this.timeoutIds.formListeners.change&&clearTimeout(this.timeoutIds.formListeners.change),this.timeoutIds.formListeners.change=setTimeout(()=>{this.form.options.listeners?.onChange?.({formApi:this.form,fieldApi:this})},a)):this.form.options.listeners?.onChange?.({formApi:this.form,fieldApi:this});const e=this.options.listeners?.onChangeDebounceMs;e&&e>0?(this.timeoutIds.listeners.change&&clearTimeout(this.timeoutIds.listeners.change),this.timeoutIds.listeners.change=setTimeout(()=>{this.options.listeners?.onChange?.({value:this.state.value,fieldApi:this})},e)):this.options.listeners?.onChange?.({value:this.state.value,fieldApi:this})}}function ie(i){if(i)return i}function W(i){switch(i){case"submit":return"onSubmit";case"blur":return"onBlur";case"mount":return"onMount";case"server":return"onServer";case"dynamic":return"onDynamic";case"change":default:return"onChange"}}function Se(i){return!["__proto__","constructor","prototype"].includes(String(i))}function oe(i,a){if(i==null||typeof i!="object")return{};if(a==null||typeof a!="object")return i;const e=Object.keys(i),t=Object.keys(a),s=new Set([...e,...t]);for(const r of s){if(!Se(r))continue;const o=r,l=r;if(!Object.hasOwn(a,l))continue;const c=a[l],h=i[o];if(Array.isArray(h)&&Array.isArray(c)){Object.defineProperty(i,r,{value:[...c],enumerable:!0,writable:!0,configurable:!0});continue}if(typeof h=="object"&&h!==null&&(typeof c=="object"&&c!==null)&&!Array.isArray(h)&&!Array.isArray(c)){oe(h,c);continue}Object.defineProperty(i,r,{value:c,enumerable:!0,writable:!0,configurable:!0})}return i}function Ve(i,a){return oe(i.state,a),i}const z=typeof window<"u"?P.useLayoutEffect:P.useEffect;function Fe(i){const[a]=P.useState(()=>{const t=new be({...i,form:i.form,name:i.name});return t.Field=ne,t});return z(a.mount,[a]),z(()=>{a.update(i)}),re(a.store,i.mode==="array"?e=>[e.meta,Object.keys(e.value??[]).length]:void 0),a}const ne=(({children:i,...a})=>{const e=Fe(a),t=P.useMemo(()=>N(i,e),[i,e,e.state.value,e.state.meta]);return F.jsx(F.Fragment,{children:t})});function Ae({form:i,selector:a,children:e}){const t=re(i.store,a);return N(e,t)}function we(i){const[a]=P.useState(()=>{const e=new ye(i),t=e;return t.Field=function(r){return F.jsx(ne,{...r,form:e})},t.Subscribe=function(r){return F.jsx(Ae,{form:e,selector:r.selector,children:r.children})},t});return z(a.mount,[]),z(()=>{a.update(i)}),a}function Ee(i,a){return{fn:i,deps:a}}const Oe=Z.object({name:Z.string().min(3)}),Ie={defaultValues:{name:""},validators:{onChange:Oe}};function ke(){const{state:i}=ue.useLoaderData(),a=we({...Ie,transform:Ee(e=>Ve(e,i),[i])});return F.jsx("div",{className:"flex flex-col items-center justify-center h-screen bg-neutral-50",children:F.jsxs("form",{action:ce.url,method:"post",encType:"multipart/form-data",className:"flex flex-col gap-4 bg-white p-4 rounded-xl border border-neutral-200 w-full max-w-md",children:[F.jsx(a.Field,{name:"name",children:e=>F.jsxs("div",{children:[F.jsx("input",{name:e.name,type:"text",value:e.state.value,onChange:t=>e.handleChange(t.target.value),className:"w-full p-2 rounded-md border border-neutral-200"}),e.state.meta.errors.map(t=>F.jsx("p",{className:"text-red-500 text-sm font-medium",children:t?.message},t))]})}),F.jsx(a.Subscribe,{selector:e=>[e.canSubmit,e.isSubmitting],children:([e,t])=>F.jsx("button",{type:"submit",disabled:!e,className:"w-full p-2 rounded-md border border-neutral-200",children:t?"...":"Submit"})})]})})}export{ke as component};
